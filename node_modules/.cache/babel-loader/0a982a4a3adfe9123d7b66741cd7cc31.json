{"ast":null,"code":"import { getWindow } from 'ssr-window';\nimport $ from '../../shared/dom7';\nimport { bindMethods } from '../../shared/utils';\nimport { getSupport } from '../../shared/get-support';\nvar Lazy = {\n  destroy: function destroy(pageEl) {\n    var $pageEl = $(pageEl).closest('.page');\n    if (!$pageEl.length) return;\n\n    if ($pageEl[0].f7LazyDestroy) {\n      $pageEl[0].f7LazyDestroy();\n    }\n  },\n  create: function create(pageEl) {\n    var app = this;\n    var window = getWindow();\n    var support = getSupport();\n    var $pageEl = $(pageEl).closest('.page').eq(0); // Lazy images\n\n    var $lazyLoadImages = $pageEl.find('.lazy');\n    if ($lazyLoadImages.length === 0 && !$pageEl.hasClass('lazy')) return; // Placeholder\n\n    var placeholderSrc = app.params.lazy.placeholder;\n\n    if (placeholderSrc !== false) {\n      $lazyLoadImages.each(function (lazyEl) {\n        if ($(lazyEl).attr('data-src') && !$(lazyEl).attr('src')) $(lazyEl).attr('src', placeholderSrc);\n      });\n    } // load image\n\n\n    var imagesSequence = [];\n    var imageIsLoading = false;\n\n    function onImageComplete(lazyEl) {\n      if (imagesSequence.indexOf(lazyEl) >= 0) {\n        imagesSequence.splice(imagesSequence.indexOf(lazyEl), 1);\n      }\n\n      imageIsLoading = false;\n\n      if (app.params.lazy.sequential && imagesSequence.length > 0) {\n        imageIsLoading = true;\n        app.lazy.loadImage(imagesSequence[0], onImageComplete);\n      }\n    }\n\n    function observerCallback(entries, observer) {\n      entries.forEach(function (entry) {\n        if (entry.isIntersecting) {\n          if (app.params.lazy.sequential && imageIsLoading) {\n            if (imagesSequence.indexOf(entry.target) < 0) imagesSequence.push(entry.target);\n            return;\n          } // Load image\n\n\n          imageIsLoading = true;\n          app.lazy.loadImage(entry.target, onImageComplete); // Detach\n\n          observer.unobserve(entry.target);\n        }\n      });\n    }\n\n    if (app.params.lazy.observer && support.intersectionObserver) {\n      var observer = $pageEl[0].f7LazyObserver;\n\n      if (!observer) {\n        observer = new window.IntersectionObserver(observerCallback, {\n          root: $pageEl[0]\n        });\n      }\n\n      $lazyLoadImages.each(function (el) {\n        if (el.f7LazyObserverAdded) return;\n        el.f7LazyObserverAdded = true;\n        observer.observe(el);\n      });\n\n      if (!$pageEl[0].f7LazyDestroy) {\n        $pageEl[0].f7LazyDestroy = function () {\n          observer.disconnect();\n          delete $pageEl[0].f7LazyDestroy;\n          delete $pageEl[0].f7LazyObserver;\n        };\n      }\n\n      return;\n    }\n\n    function lazyHandler() {\n      app.lazy.load($pageEl, function (lazyEl) {\n        if (app.params.lazy.sequential && imageIsLoading) {\n          if (imagesSequence.indexOf(lazyEl) < 0) imagesSequence.push(lazyEl);\n          return;\n        }\n\n        imageIsLoading = true;\n        app.lazy.loadImage(lazyEl, onImageComplete);\n      });\n    }\n\n    function attachEvents() {\n      $pageEl[0].f7LazyAttached = true;\n      $pageEl.on('lazy', lazyHandler);\n      $pageEl.on('scroll', lazyHandler, true);\n      $pageEl.find('.tab').on('tab:mounted tab:show', lazyHandler);\n      app.on('resize', lazyHandler);\n    }\n\n    function detachEvents() {\n      $pageEl[0].f7LazyAttached = false;\n      delete $pageEl[0].f7LazyAttached;\n      $pageEl.off('lazy', lazyHandler);\n      $pageEl.off('scroll', lazyHandler, true);\n      $pageEl.find('.tab').off('tab:mounted tab:show', lazyHandler);\n      app.off('resize', lazyHandler);\n    } // Store detach function\n\n\n    if (!$pageEl[0].f7LazyDestroy) {\n      $pageEl[0].f7LazyDestroy = detachEvents;\n    } // Attach events\n\n\n    if (!$pageEl[0].f7LazyAttached) {\n      attachEvents();\n    } // Run loader on page load/init\n\n\n    lazyHandler();\n  },\n  isInViewport: function isInViewport(lazyEl) {\n    var app = this;\n    var rect = lazyEl.getBoundingClientRect();\n    var threshold = app.params.lazy.threshold || 0;\n    return rect.top >= 0 - threshold && rect.left >= 0 - threshold && rect.top <= app.height + threshold && rect.left <= app.width + threshold;\n  },\n  loadImage: function loadImage(imageEl, callback) {\n    var app = this;\n    var window = getWindow();\n    var $imageEl = $(imageEl);\n    var bg = $imageEl.attr('data-background');\n    var src = bg || $imageEl.attr('data-src');\n\n    function onLoad() {\n      $imageEl.removeClass('lazy').addClass('lazy-loaded');\n\n      if (bg) {\n        $imageEl.css('background-image', \"url(\" + src + \")\");\n      } else if (src) {\n        $imageEl.attr('src', src);\n      }\n\n      if (callback) callback(imageEl);\n      $imageEl.trigger('lazy:loaded');\n      app.emit('lazyLoaded', $imageEl[0]);\n    }\n\n    if (!src) {\n      $imageEl.trigger('lazy:load');\n      app.emit('lazyLoad', $imageEl[0]);\n      onLoad();\n      return;\n    }\n\n    function onError() {\n      $imageEl.removeClass('lazy').addClass('lazy-loaded');\n\n      if (bg) {\n        $imageEl.css('background-image', \"url(\" + (app.params.lazy.placeholder || '') + \")\");\n      } else {\n        $imageEl.attr('src', app.params.lazy.placeholder || '');\n      }\n\n      if (callback) callback(imageEl);\n      $imageEl.trigger('lazy:error');\n      app.emit('lazyError', $imageEl[0]);\n    }\n\n    var image = new window.Image();\n    image.onload = onLoad;\n    image.onerror = onError;\n    image.src = src;\n    $imageEl.removeAttr('data-src').removeAttr('data-background'); // Add loaded callback and events\n\n    $imageEl.trigger('lazy:load');\n    app.emit('lazyLoad', $imageEl[0]);\n  },\n  load: function load(pageEl, callback) {\n    var app = this;\n    var $pageEl = $(pageEl);\n    if (!$pageEl.hasClass('page')) $pageEl = $pageEl.parents('.page').eq(0);\n\n    if ($pageEl.length === 0) {\n      return;\n    }\n\n    $pageEl.find('.lazy').each(function (lazyEl) {\n      var $lazyEl = $(lazyEl);\n\n      if ($lazyEl.parents('.tab:not(.tab-active)').length > 0) {\n        return;\n      }\n\n      if (app.lazy.isInViewport(lazyEl)) {\n        if (callback) callback(lazyEl);else app.lazy.loadImage(lazyEl);\n      }\n    });\n  }\n};\nexport default {\n  name: 'lazy',\n  params: {\n    lazy: {\n      placeholder: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEXCwsK592mkAAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==',\n      threshold: 0,\n      sequential: true,\n      observer: true\n    }\n  },\n  create: function create() {\n    var app = this;\n    bindMethods(app, {\n      lazy: Lazy\n    });\n  },\n  on: {\n    pageInit: function pageInit(page) {\n      var app = this;\n\n      if (page.$el.find('.lazy').length > 0 || page.$el.hasClass('lazy')) {\n        app.lazy.create(page.$el);\n      }\n    },\n    pageAfterIn: function pageAfterIn(page) {\n      var app = this;\n      var support = getSupport();\n      if (app.params.lazy.observer && support.intersectionObserver) return;\n\n      if (page.$el.find('.lazy').length > 0 || page.$el.hasClass('lazy')) {\n        app.lazy.create(page.$el);\n      }\n    },\n    pageBeforeRemove: function pageBeforeRemove(page) {\n      var app = this;\n\n      if (page.$el.find('.lazy').length > 0 || page.$el.hasClass('lazy')) {\n        app.lazy.destroy(page.$el);\n      }\n    },\n    tabMounted: function tabMounted(tabEl) {\n      var app = this;\n      var $tabEl = $(tabEl);\n\n      if ($tabEl.find('.lazy').length > 0 || $tabEl.hasClass('lazy')) {\n        app.lazy.create($tabEl);\n      }\n    },\n    tabBeforeRemove: function tabBeforeRemove(tabEl) {\n      var app = this;\n      var support = getSupport();\n      if (app.params.lazy.observer && support.intersectionObserver) return;\n      var $tabEl = $(tabEl);\n\n      if ($tabEl.find('.lazy').length > 0 || $tabEl.hasClass('lazy')) {\n        app.lazy.destroy($tabEl);\n      }\n    }\n  }\n};","map":{"version":3,"sources":["E:/Programming/React/rashiApp/node_modules/framework7/esm/components/lazy/lazy.js"],"names":["getWindow","$","bindMethods","getSupport","Lazy","destroy","pageEl","$pageEl","closest","length","f7LazyDestroy","create","app","window","support","eq","$lazyLoadImages","find","hasClass","placeholderSrc","params","lazy","placeholder","each","lazyEl","attr","imagesSequence","imageIsLoading","onImageComplete","indexOf","splice","sequential","loadImage","observerCallback","entries","observer","forEach","entry","isIntersecting","target","push","unobserve","intersectionObserver","f7LazyObserver","IntersectionObserver","root","el","f7LazyObserverAdded","observe","disconnect","lazyHandler","load","attachEvents","f7LazyAttached","on","detachEvents","off","isInViewport","rect","getBoundingClientRect","threshold","top","left","height","width","imageEl","callback","$imageEl","bg","src","onLoad","removeClass","addClass","css","trigger","emit","onError","image","Image","onload","onerror","removeAttr","parents","$lazyEl","name","pageInit","page","$el","pageAfterIn","pageBeforeRemove","tabMounted","tabEl","$tabEl","tabBeforeRemove"],"mappings":"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","sourcesContent":["import { getWindow } from 'ssr-window';\nimport $ from '../../shared/dom7';\nimport { bindMethods } from '../../shared/utils';\nimport { getSupport } from '../../shared/get-support';\nvar Lazy = {\n  destroy: function destroy(pageEl) {\n    var $pageEl = $(pageEl).closest('.page');\n    if (!$pageEl.length) return;\n\n    if ($pageEl[0].f7LazyDestroy) {\n      $pageEl[0].f7LazyDestroy();\n    }\n  },\n  create: function create(pageEl) {\n    var app = this;\n    var window = getWindow();\n    var support = getSupport();\n    var $pageEl = $(pageEl).closest('.page').eq(0); // Lazy images\n\n    var $lazyLoadImages = $pageEl.find('.lazy');\n    if ($lazyLoadImages.length === 0 && !$pageEl.hasClass('lazy')) return; // Placeholder\n\n    var placeholderSrc = app.params.lazy.placeholder;\n\n    if (placeholderSrc !== false) {\n      $lazyLoadImages.each(function (lazyEl) {\n        if ($(lazyEl).attr('data-src') && !$(lazyEl).attr('src')) $(lazyEl).attr('src', placeholderSrc);\n      });\n    } // load image\n\n\n    var imagesSequence = [];\n    var imageIsLoading = false;\n\n    function onImageComplete(lazyEl) {\n      if (imagesSequence.indexOf(lazyEl) >= 0) {\n        imagesSequence.splice(imagesSequence.indexOf(lazyEl), 1);\n      }\n\n      imageIsLoading = false;\n\n      if (app.params.lazy.sequential && imagesSequence.length > 0) {\n        imageIsLoading = true;\n        app.lazy.loadImage(imagesSequence[0], onImageComplete);\n      }\n    }\n\n    function observerCallback(entries, observer) {\n      entries.forEach(function (entry) {\n        if (entry.isIntersecting) {\n          if (app.params.lazy.sequential && imageIsLoading) {\n            if (imagesSequence.indexOf(entry.target) < 0) imagesSequence.push(entry.target);\n            return;\n          } // Load image\n\n\n          imageIsLoading = true;\n          app.lazy.loadImage(entry.target, onImageComplete); // Detach\n\n          observer.unobserve(entry.target);\n        }\n      });\n    }\n\n    if (app.params.lazy.observer && support.intersectionObserver) {\n      var observer = $pageEl[0].f7LazyObserver;\n\n      if (!observer) {\n        observer = new window.IntersectionObserver(observerCallback, {\n          root: $pageEl[0]\n        });\n      }\n\n      $lazyLoadImages.each(function (el) {\n        if (el.f7LazyObserverAdded) return;\n        el.f7LazyObserverAdded = true;\n        observer.observe(el);\n      });\n\n      if (!$pageEl[0].f7LazyDestroy) {\n        $pageEl[0].f7LazyDestroy = function () {\n          observer.disconnect();\n          delete $pageEl[0].f7LazyDestroy;\n          delete $pageEl[0].f7LazyObserver;\n        };\n      }\n\n      return;\n    }\n\n    function lazyHandler() {\n      app.lazy.load($pageEl, function (lazyEl) {\n        if (app.params.lazy.sequential && imageIsLoading) {\n          if (imagesSequence.indexOf(lazyEl) < 0) imagesSequence.push(lazyEl);\n          return;\n        }\n\n        imageIsLoading = true;\n        app.lazy.loadImage(lazyEl, onImageComplete);\n      });\n    }\n\n    function attachEvents() {\n      $pageEl[0].f7LazyAttached = true;\n      $pageEl.on('lazy', lazyHandler);\n      $pageEl.on('scroll', lazyHandler, true);\n      $pageEl.find('.tab').on('tab:mounted tab:show', lazyHandler);\n      app.on('resize', lazyHandler);\n    }\n\n    function detachEvents() {\n      $pageEl[0].f7LazyAttached = false;\n      delete $pageEl[0].f7LazyAttached;\n      $pageEl.off('lazy', lazyHandler);\n      $pageEl.off('scroll', lazyHandler, true);\n      $pageEl.find('.tab').off('tab:mounted tab:show', lazyHandler);\n      app.off('resize', lazyHandler);\n    } // Store detach function\n\n\n    if (!$pageEl[0].f7LazyDestroy) {\n      $pageEl[0].f7LazyDestroy = detachEvents;\n    } // Attach events\n\n\n    if (!$pageEl[0].f7LazyAttached) {\n      attachEvents();\n    } // Run loader on page load/init\n\n\n    lazyHandler();\n  },\n  isInViewport: function isInViewport(lazyEl) {\n    var app = this;\n    var rect = lazyEl.getBoundingClientRect();\n    var threshold = app.params.lazy.threshold || 0;\n    return rect.top >= 0 - threshold && rect.left >= 0 - threshold && rect.top <= app.height + threshold && rect.left <= app.width + threshold;\n  },\n  loadImage: function loadImage(imageEl, callback) {\n    var app = this;\n    var window = getWindow();\n    var $imageEl = $(imageEl);\n    var bg = $imageEl.attr('data-background');\n    var src = bg || $imageEl.attr('data-src');\n\n    function onLoad() {\n      $imageEl.removeClass('lazy').addClass('lazy-loaded');\n\n      if (bg) {\n        $imageEl.css('background-image', \"url(\" + src + \")\");\n      } else if (src) {\n        $imageEl.attr('src', src);\n      }\n\n      if (callback) callback(imageEl);\n      $imageEl.trigger('lazy:loaded');\n      app.emit('lazyLoaded', $imageEl[0]);\n    }\n\n    if (!src) {\n      $imageEl.trigger('lazy:load');\n      app.emit('lazyLoad', $imageEl[0]);\n      onLoad();\n      return;\n    }\n\n    function onError() {\n      $imageEl.removeClass('lazy').addClass('lazy-loaded');\n\n      if (bg) {\n        $imageEl.css('background-image', \"url(\" + (app.params.lazy.placeholder || '') + \")\");\n      } else {\n        $imageEl.attr('src', app.params.lazy.placeholder || '');\n      }\n\n      if (callback) callback(imageEl);\n      $imageEl.trigger('lazy:error');\n      app.emit('lazyError', $imageEl[0]);\n    }\n\n    var image = new window.Image();\n    image.onload = onLoad;\n    image.onerror = onError;\n    image.src = src;\n    $imageEl.removeAttr('data-src').removeAttr('data-background'); // Add loaded callback and events\n\n    $imageEl.trigger('lazy:load');\n    app.emit('lazyLoad', $imageEl[0]);\n  },\n  load: function load(pageEl, callback) {\n    var app = this;\n    var $pageEl = $(pageEl);\n    if (!$pageEl.hasClass('page')) $pageEl = $pageEl.parents('.page').eq(0);\n\n    if ($pageEl.length === 0) {\n      return;\n    }\n\n    $pageEl.find('.lazy').each(function (lazyEl) {\n      var $lazyEl = $(lazyEl);\n\n      if ($lazyEl.parents('.tab:not(.tab-active)').length > 0) {\n        return;\n      }\n\n      if (app.lazy.isInViewport(lazyEl)) {\n        if (callback) callback(lazyEl);else app.lazy.loadImage(lazyEl);\n      }\n    });\n  }\n};\nexport default {\n  name: 'lazy',\n  params: {\n    lazy: {\n      placeholder: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEXCwsK592mkAAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==',\n      threshold: 0,\n      sequential: true,\n      observer: true\n    }\n  },\n  create: function create() {\n    var app = this;\n    bindMethods(app, {\n      lazy: Lazy\n    });\n  },\n  on: {\n    pageInit: function pageInit(page) {\n      var app = this;\n\n      if (page.$el.find('.lazy').length > 0 || page.$el.hasClass('lazy')) {\n        app.lazy.create(page.$el);\n      }\n    },\n    pageAfterIn: function pageAfterIn(page) {\n      var app = this;\n      var support = getSupport();\n      if (app.params.lazy.observer && support.intersectionObserver) return;\n\n      if (page.$el.find('.lazy').length > 0 || page.$el.hasClass('lazy')) {\n        app.lazy.create(page.$el);\n      }\n    },\n    pageBeforeRemove: function pageBeforeRemove(page) {\n      var app = this;\n\n      if (page.$el.find('.lazy').length > 0 || page.$el.hasClass('lazy')) {\n        app.lazy.destroy(page.$el);\n      }\n    },\n    tabMounted: function tabMounted(tabEl) {\n      var app = this;\n      var $tabEl = $(tabEl);\n\n      if ($tabEl.find('.lazy').length > 0 || $tabEl.hasClass('lazy')) {\n        app.lazy.create($tabEl);\n      }\n    },\n    tabBeforeRemove: function tabBeforeRemove(tabEl) {\n      var app = this;\n      var support = getSupport();\n      if (app.params.lazy.observer && support.intersectionObserver) return;\n      var $tabEl = $(tabEl);\n\n      if ($tabEl.find('.lazy').length > 0 || $tabEl.hasClass('lazy')) {\n        app.lazy.destroy($tabEl);\n      }\n    }\n  }\n};"]},"metadata":{},"sourceType":"module"}